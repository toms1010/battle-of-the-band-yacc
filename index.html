<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>YACC 2025 Battle of the Bands - Registration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a2a6c;
            --secondary-color: #2a3c84;
            --accent-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px;
        }
        
        /* MOBILE FIRST - Header Styles */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            flex-direction: column;
        }
        
        .main-logo {
            width: 120px;
            height: 120px;
            object-fit: contain;
            max-width: 100%;
        }
        
        .secondary-logo {
            width: 100px;
            height: 100px;
            object-fit: contain;
            max-width: 100%;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 1.8rem;
            line-height: 1.3;
            word-wrap: break-word;
        }
        
        .subtitle {
            color: var(--secondary-color);
            font-size: 1rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        /* Status Bar - Mobile Optimized */
        .status-bar {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: stretch;
        }
        
        .status-bar > div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .slot-counter {
            background: var(--primary-color);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .status-open {
            background: var(--accent-color);
            color: white;
        }
        
        .status-full {
            background: var(--warning-color);
            color: var(--dark-color);
        }
        
        #lastUpdated {
            font-size: 0.8rem;
            color: #666;
            flex: 1;
            text-align: center;
        }
        
        /* Progress Container - Mobile Friendly */
        .progress-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }
        
        .progress-steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 30px;
            padding: 0 5px;
        }
        
        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 5%;
            right: 5%;
            height: 3px;
            background: var(--border-color);
            z-index: 1;
        }
        
        .progress-bar {
            position: absolute;
            top: 20px;
            left: 5%;
            height: 3px;
            background: var(--accent-color);
            z-index: 2;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .step {
            position: relative;
            z-index: 3;
            text-align: center;
            width: 20%;
            min-width: 0;
        }
        
        .step-circle {
            width: 36px;
            height: 36px;
            background: white;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--dark-color);
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .step.active .step-circle {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }
        
        .step.completed .step-circle {
            border-color: var(--accent-color);
            background: var(--accent-color);
            color: white;
        }
        
        .step-label {
            font-size: 0.75rem;
            color: var(--dark-color);
            font-weight: 500;
            line-height: 1.2;
            display: block;
            word-break: break-word;
        }
        
        .step.active .step-label {
            color: var(--accent-color);
            font-weight: bold;
        }
        
        /* Form Container - Touch Friendly */
        .form-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .form-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .form-step.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .form-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-color);
            font-size: 1.3rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }
        
        label.required::after {
            content: " *";
            color: var(--danger-color);
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="password"],
        select,
        textarea {
            width: 100%;
            padding: 14px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
            min-height: 48px;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 42, 108, 0.1);
        }
        
        /* Larger touch targets for mobile */
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%231a2a6c' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }
        
        .checkbox-group {
            background: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            font-weight: normal;
            cursor: pointer;
            padding: 4px 0;
            min-height: 24px;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            min-width: 20px;
        }
        
        .checkbox-group input:disabled + span {
            opacity: 0.5;
        }
        
        /* Alert & Rules Boxes */
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid;
            font-size: 0.95rem;
        }
        
        .alert-warning {
            background: #fff8e1;
            border-left-color: var(--warning-color);
            color: #856404;
        }
        
        .alert-info {
            background: #e8f4fc;
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .alert-danger {
            background: #f8d7da;
            border-left-color: var(--danger-color);
            color: #721c24;
        }
        
        .alert-success {
            background: #d4edda;
            border-left-color: var(--accent-color);
            color: #155724;
        }
        
        .rules-box {
            background: #f8f9fa;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .rules-box h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }
        
        .rules-box ul {
            padding-left: 20px;
            margin-bottom: 12px;
        }
        
        .rules-box li {
            margin-bottom: 6px;
            position: relative;
            font-size: 0.95rem;
        }
        
        .rules-box li::before {
            content: '•';
            color: var(--primary-color);
            font-weight: bold;
            margin-right: 8px;
        }
        
        /* Member Rows - Stack on mobile */
        .member-section {
            background: var(--light-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .member-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }
        
        /* Button Styles - Touch Optimized */
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            min-height: 56px;
            touch-action: manipulation;
        }
        
        .btn-prev {
            background: var(--dark-color);
            color: white;
        }
        
        .btn-prev:hover,
        .btn-prev:active {
            background: #23272b;
            transform: translateY(-2px);
        }
        
        .btn-next {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-next:hover,
        .btn-next:active {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-submit {
            background: var(--accent-color);
            color: white;
        }
        
        .btn-submit:hover,
        .btn-submit:active {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Summary Box */
        .summary-box {
            background: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .summary-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            font-size: 0.95rem;
        }
        
        /* Agreement Box */
        .agreement-box {
            background: #f0f7ff;
            border: 1px solid #cce5ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .terms-container {
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 12px 0;
            font-size: 0.9rem;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 15px;
            background: var(--primary-color);
            color: white;
            font-size: 0.85rem;
            margin-top: 20px;
            border-radius: 10px;
        }
        
        .footer-links {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }
        
        .footer-links a {
            color: white;
            text-decoration: none;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        .footer-badge {
            margin-top: 10px;
        }
        
        .footer-badge img {
            width: 70px;
            height: 70px;
            object-fit: contain;
        }
        
        /* Loading Overlay - Enhanced for Mobile */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            display: none;
            backdrop-filter: blur(3px);
        }
        
        .loading-content {
            text-align: center;
            color: white;
            padding: 30px;
            background: rgba(26, 42, 108, 0.9);
            border-radius: 15px;
            max-width: 300px;
            width: 90%;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.1rem;
            margin-top: 15px;
        }
        
        /* Modal - Mobile Friendly */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
            padding: 15px;
            backdrop-filter: blur(3px);
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-icon {
            font-size: 50px;
            color: var(--accent-color);
            margin-bottom: 20px;
        }
        
        .modal-actions {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .modal-actions .btn {
            min-height: 50px;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        /* Success/Error Animations */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .success-animation {
            animation: successPulse 0.5s ease 2;
            background-color: var(--accent-color) !important;
        }
        
        .error-animation {
            animation: errorShake 0.5s ease;
            background-color: var(--danger-color) !important;
        }
        
        /* Tablet and Desktop Styles */
        @media (min-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1.1rem;
            }
            
            .logo-container {
                flex-direction: row;
                gap: 20px;
            }
            
            .status-bar {
                flex-direction: row;
                align-items: center;
                padding: 15px 20px;
            }
            
            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }
            
            .member-row {
                grid-template-columns: 1fr 1fr;
            }
            
            .button-group {
                flex-direction: row;
                justify-content: space-between;
            }
            
            .btn {
                width: auto;
                min-width: 140px;
            }
            
            .modal-actions {
                flex-direction: row;
                justify-content: center;
            }
        }
        
        @media (min-width: 1024px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .progress-steps::before {
                left: 10%;
                right: 10%;
            }
            
            .progress-bar {
                left: 10%;
            }
        }
        
        /* Hide scrollbar but keep functionality */
        .terms-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .terms-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .terms-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        /* Prevent zoom on focus for iOS */
        @media (max-width: 768px) {
            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="password"],
            select,
            textarea {
                font-size: 16px; /* Prevents iOS zoom on focus */
            }
        }
        
        /* Safe area insets for iPhone X+ */
        @supports (padding: max(0px)) {
            body, .container {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
            }
            
            .modal-content {
                padding-bottom: max(25px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Logos -->
        <header>
            <div class="logo-container">
                <img src="https://i.ibb.co/3m5w9nBF/yacc-logo-removebg-preview.png" alt="YACC Logo" class="main-logo">
                <img src="https://i.ibb.co/397cCm70/OIP-1-removebg-preview.png" alt="YACC Badge" class="secondary-logo">
            </div>
            <h1>YACC 2025 Battle of the Bands</h1>
            <p class="subtitle">Celebrating Heritage Through Traditional Hymns</p>
        </header>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div>
                <div class="slot-counter" id="slotCounter">
                    Loading slots...
                </div>
                <div id="statusBadge" class="status-badge status-open">
                    Registration Open
                </div>
            </div>
            <div id="lastUpdated">
                Last Updated: <span id="updateTime">Just now</span>
            </div>
        </div>
        
        <!-- Progress Container -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="progress-bar" id="progressBar"></div>
                <div class="step active" id="step1-indicator">
                    <div class="step-circle">1</div>
                    <div class="step-label">Church Info</div>
                </div>
                <div class="step" id="step2-indicator">
                    <div class="step-circle">2</div>
                    <div class="step-label">Band Details</div>
                </div>
                <div class="step" id="step3-indicator">
                    <div class="step-circle">3</div>
                    <div class="step-label">Hymn Selection</div>
                </div>
                <div class="step" id="step4-indicator">
                    <div class="step-circle">4</div>
                    <div class="step-label">Equipment</div>
                </div>
                <div class="step" id="step5-indicator">
                    <div class="step-circle">5</div>
                    <div class="step-label">Confirmation</div>
                </div>
            </div>
            
            <!-- Form Container -->
            <div class="form-container">
                <form id="registrationForm">
                    <!-- Step 1: Church Information -->
                    <div id="step1" class="form-step active">
                        <h3 class="form-title">Church Information</h3>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> All fields marked with * are required.
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="churchName" class="required">Church Name</label>
                                <input type="text" id="churchName" placeholder="e.g., Grace Community Church" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="churchAddress">Church Address</label>
                                <input type="text" id="churchAddress" placeholder="Full address">
                            </div>
                            
                            <div class="form-group">
                                <label for="pastorName" class="required">Pastor/Leader Name</label>
                                <input type="text" id="pastorName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="churchEmail" class="required">Church Email</label>
                                <input type="email" id="churchEmail" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="churchPhone" class="required">Church Phone</label>
                                <input type="tel" id="churchPhone" required>
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <div></div>
                            <button type="button" class="btn btn-next" onclick="validateStep(1)">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Band Details -->
                    <div id="step2" class="form-step">
                        <h3 class="form-title">Band Details</h3>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> Only the first 7 groups to register will be accepted. First-come, first-served.
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="bandName" class="required">Band Name</label>
                                <input type="text" id="bandName" placeholder="e.g., Hymn Revolution" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="memberCount" class="required">Number of Members</label>
                                <select id="memberCount" onchange="generateMemberFields()" required>
                                    <option value="">Select...</option>
                                    <option value="3">3 Members</option>
                                    <option value="4">4 Members</option>
                                    <option value="5">5 Members</option>
                                    <option value="6">6 Members</option>
                                </select>
                                <small>Must have 3-6 members (including leader)</small>
                            </div>
                        </div>
                        
                        <!-- Dynamic Member Fields -->
                        <div id="memberFields">
                            <!-- Generated by JavaScript -->
                        </div>
                        
                        <div class="form-group">
                            <label class="required">Band Leader (Primary Contact)</label>
                            <input type="text" id="leaderName" placeholder="Full Name" required>
                            <div style="margin-top: 10px;"></div>
                            <input type="email" id="leaderEmail" placeholder="Email Address" required>
                            <div style="margin-top: 10px;"></div>
                            <input type="tel" id="leaderPhone" placeholder="Phone Number" required>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep(1)">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button type="button" class="btn btn-next" onclick="validateStep(2)">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Hymn Selection -->
                    <div id="step3" class="form-step">
                        <h3 class="form-title">Hymn Selection</h3>
                        
                        <div class="rules-box">
                            <h4><i class="fas fa-exclamation-circle"></i> CRITICAL RULES:</h4>
                            <ul>
                                <li><strong>✅ Traditional Hymns ONLY</strong></li>
                                <li><strong>❌ NO Contemporary Christian Music (CCM)</strong></li>
                                <li><strong>❌ NO Modern Worship Songs</strong></li>
                                <li><strong>⚠️ Violation = Immediate Disqualification</strong></li>
                            </ul>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="primaryHymn" class="required">Primary Hymn</label>
                                <select id="primaryHymn" onchange="toggleOtherHymnField()" required>
                                    <option value="">Select a hymn...</option>
                                    <option value="Amazing Grace">Amazing Grace</option>
                                    <option value="How Great Thou Art">How Great Thou Art</option>
                                    <option value="Great Is Thy Faithfulness">Great Is Thy Faithfulness</option>
                                    <option value="It Is Well With My Soul">It Is Well With My Soul</option>
                                    <option value="The Old Rugged Cross">The Old Rugged Cross</option>
                                    <option value="Blessed Assurance">Blessed Assurance</option>
                                    <option value="Rock of Ages">Rock of Ages</option>
                                    <option value="other">Other (Specify below)</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="otherHymnContainer" style="display: none;">
                                <label for="otherHymn" class="required">Specify Hymn Name</label>
                                <input type="text" id="otherHymn" placeholder="Traditional hymn name">
                                <small>Must be a traditional hymn from a recognized hymnal</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="secondaryHymn">Secondary Hymn (Optional)</label>
                                <select id="secondaryHymn">
                                    <option value="">Optional second hymn...</option>
                                    <option value="Amazing Grace">Amazing Grace</option>
                                    <option value="How Great Thou Art">How Great Thou Art</option>
                                    <option value="Great Is Thy Faithfulness">Great Is Thy Faithfulness</option>
                                    <option value="It Is Well With My Soul">It Is Well With My Soul</option>
                                    <option value="The Old Rugged Cross">The Old Rugged Cross</option>
                                    <option value="Blessed Assurance">Blessed Assurance</option>
                                    <option value="Rock of Ages">Rock of Ages</option>
                                    <option value="other2">Other (Specify in notes)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="performanceTime" class="required">Total Performance Time</label>
                                <input type="text" id="performanceTime" placeholder="e.g., 4:30" pattern="[0-5]:[0-5][0-9]" required>
                                <small>Maximum 5 minutes. Format: M:SS (e.g., 4:30 for 4 minutes 30 seconds)</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="arrangement">Performance Style/Arrangement Description</label>
                            <textarea id="arrangement" rows="3" placeholder="Briefly describe your unique arrangement..."></textarea>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep(2)">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button type="button" class="btn btn-next" onclick="validateStep(3)">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 4: Equipment Needs -->
                    <div id="step4" class="form-step">
                        <h3 class="form-title">Equipment Requirements</h3>
                        
                        <div class="rules-box">
                            <h4><i class="fas fa-check-circle"></i> Standard Equipment Provided:</h4>
                            <ul>
                                <li>Drum kit </li>
                                <li>4 Vocal microphones with stands</li>
                                <li> Instrument microphones</li>
                                <li>Keyboard stand</li>
                                
                                <li>Monitor wedges</li>
                            </ul>
                        </div>
                        
                        <div class="checkbox-group">
                            <h4>Additional Equipment Needed</h4>
                            <label>
                                <input type="checkbox" id="extraMics" onchange="toggleExtraMics()">
                                <span>Additional vocal mic(s)</span>
                                <input type="number" id="extraMicCount" min="1" value="1" style="margin-left: 10px; width: 60px;" disabled>
                                <span style="margin-left: 5px;">how many?</span>
                            </label>
                            <label>
                                <input type="checkbox" id="keyboard">
                                <span>Keyboard (please bring your own)</span>
                            </label>
                            <label>
                                <input type="checkbox" id="amp">
                                <span>Guitar/Bass amplifier</span>
                            </label>
                            <label>
                                <input type="checkbox" id="percussion">
                                <span>Special percussion</span>
                            </label>
                            <label>
                                <input type="checkbox" id="otherEquipment" onchange="toggleOtherEquipment()">
                                <span>Other:</span>
                                <input type="text" id="otherEquipmentText" placeholder="Specify" style="margin-left: 10px; flex: 1;" disabled>
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label for="specialSetup">Special Setup Requirements</label>
                            <textarea id="specialSetup" rows="3" placeholder="Any special stage setup needs..."></textarea>
                            <small>Note: You have only 2 minutes for setup/sound check. Complex setups may not be possible.</small>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep(3)">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button type="button" class="btn btn-next" onclick="validateStep(4)">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 5: Confirmation & Agreement -->
                    <div id="step5" class="form-step">
                        <h3 class="form-title">Confirmation & Agreement</h3>
                        
                        <div class="summary-box">
                            <h4><i class="fas fa-file-alt"></i> Registration Summary</h4>
                            <div id="registrationSummary">
                                <!-- Filled by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="agreement-box">
                            <h4><i class="fas fa-gavel"></i> Terms & Conditions</h4>
                            
                            <div class="terms-container">
                                <p><strong>By submitting this registration, I confirm that:</strong></p>
                                <ol>
                                    <li>Our band consists of 3-6 members as listed.</li>
                                    <li>We will perform ONLY traditional hymns as specified.</li>
                                    <li>We will NOT perform any CCM or modern worship music.</li>
                                    <li>We understand performance time is strictly 5 minutes maximum.</li>
                                    <li>We understand setup time is 2 minutes maximum.</li>
                                    <li>We accept that violation of rules may result in disqualification.</li>
                                    <li>We understand only the first 7 complete registrations are guaranteed participation.</li>
                                    <li>Our church leader has approved this registration.</li>
                                </ol>
                            </div>
                            
                            <div class="checkbox-group">
                                <label>
                                    <input type="checkbox" id="agreeTerms" required>
                                    <span>I have read and agree to all terms and conditions *</span>
                                </label>
                                
                                <label>
                                    <input type="checkbox" id="confirmHymns" required>
                                    <span>I confirm we are performing ONLY traditional hymns *</span>
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="signature" class="required">Church Leader's Digital Signature</label>
                                <input type="text" id="signature" placeholder="Type full name as signature" required>
                                <small>By typing your name, you digitally sign this registration</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dashboardPassword">Password for Dashboard Access</label>
                            <input type="password" id="dashboardPassword" placeholder="Create password (optional)">
                            <small>Optional: Create a password to access your registration dashboard later</small>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" class="btn btn-prev" onclick="prevStep(4)">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button type="button" class="btn btn-submit" onclick="submitForm()">
                                <i class="fas fa-paper-plane"></i> Submit Registration
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <div class="footer-badge">
                <img src="https://i.ibb.co/397cCm70/OIP-1-removebg-preview.png" alt="YACC Badge">
            </div>
            <p>YACC 2025 Battle of the Bands • Youth Alive Christian Church</p>
            <div class="footer-links">
                <a href="yacc2025connect@gmail.com"><i class="fas fa-envelope"></i> yacc2025connect@gmail.com</a>
                <a href="FB: YACC 2025 CONNECT"><i class="fas fa-envelope"></i> FB: YACC 2025 CONNECT</a>
            
                <span>© 2025 YACC. All rights reserved.</span>
            </div>
        </footer>
    </div>
    
    <!-- Enhanced Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">
                <i class="fas fa-cog fa-spin"></i> Processing Registration...
                <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">Please wait while we save your information</p>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>Registration Successful!</h2>
            <p id="successMessage">Your registration has been submitted successfully.</p>
            <div id="registrationDetails"></div>
            <div class="modal-actions">
                <button class="btn btn-next" onclick="closeModal()">Close</button>
                <button class="btn btn-submit" onclick="printConfirmation()">
                    <i class="fas fa-print"></i> Print Confirmation
                </button>
            </div>
        </div>
    </div>
    
    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-icon" style="color: var(--danger-color);">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <h2>Registration Error</h2>
            <p id="errorMessage">An error occurred during registration.</p>
            <div class="modal-actions">
                <button class="btn btn-next" onclick="closeErrorModal()">OK</button>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================
        // GLOBAL VARIABLES
        // ============================================
        let currentStep = 1;
        const totalSteps = 5;
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the application
            updateProgressBar();
            updateSlotStatus();
            setupEventListeners();
            
            // Update time every minute
            setInterval(updateTime, 60000);
            updateTime();
            
            // Prevent form zoom on iOS
            document.querySelectorAll('input, select, textarea').forEach(el => {
                el.addEventListener('focus', function() {
                    window.scrollTo(0, 0);
                });
            });
        });
        
        // ============================================
        // STEP NAVIGATION
        // ============================================
        function nextStep(step) {
            // Hide current step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}-indicator`).classList.remove('active');
            
            // Mark current step as completed
            document.getElementById(`step${currentStep}-indicator`).classList.add('completed');
            
            // Show next step
            currentStep = step;
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}-indicator`).classList.add('active');
            
            // Update progress bar
            updateProgressBar();
            
            // Update summary if moving to step 5
            if (step === 5) {
                updateSummary();
            }
            
            // Scroll to top on mobile
            if (window.innerWidth <= 768) {
                window.scrollTo(0, 0);
            }
        }
        
        function prevStep(step) {
            // Hide current step
            document.getElementById(`step${currentStep}`).classList.remove('active');
            document.getElementById(`step${currentStep}-indicator`).classList.remove('active');
            
            // Remove completed status from current step
            document.getElementById(`step${currentStep}-indicator`).classList.remove('completed');
            
            // Show previous step
            currentStep = step;
            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById(`step${currentStep}-indicator`).classList.add('active');
            
            // Update progress bar
            updateProgressBar();
            
            // Scroll to top on mobile
            if (window.innerWidth <= 768) {
                window.scrollTo(0, 0);
            }
        }
        
        function updateProgressBar() {
            const progressPercentage = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressBar').style.width = `${progressPercentage}%`;
        }
        
        // ============================================
        // FORM VALIDATION
        // ============================================
        function validateStep(step) {
            let isValid = true;
            
            switch(step) {
                case 1:
                    isValid = validateStep1();
                    break;
                case 2:
                    isValid = validateStep2();
                    break;
                case 3:
                    isValid = validateStep3();
                    break;
                case 4:
                    isValid = validateStep4();
                    break;
            }
            
            if (isValid) {
                nextStep(step + 1);
            } else {
                showError('Please fix the errors before proceeding.');
            }
        }
        
        function validateStep1() {
            const requiredFields = [
                { id: 'churchName', name: 'Church Name' },
                { id: 'pastorName', name: 'Pastor/Leader Name' },
                { id: 'churchEmail', name: 'Church Email' },
                { id: 'churchPhone', name: 'Church Phone' }
            ];
            
            let isValid = true;
            
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value.trim()) {
                    markFieldError(element, `${field.name} is required`);
                    isValid = false;
                } else if (field.id.includes('Email') && !isValidEmail(element.value)) {
                    markFieldError(element, 'Please enter a valid email address');
                    isValid = false;
                } else {
                    clearFieldError(element);
                }
            });
            
            return isValid;
        }
        
        function validateStep2() {
            const requiredFields = [
                { id: 'bandName', name: 'Band Name' },
                { id: 'memberCount', name: 'Number of Members' },
                { id: 'leaderName', name: 'Band Leader Name' },
                { id: 'leaderEmail', name: 'Band Leader Email' },
                { id: 'leaderPhone', name: 'Band Leader Phone' }
            ];
            
            let isValid = true;
            
            // Check required fields
            requiredFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (!element.value.trim()) {
                    markFieldError(element, `${field.name} is required`);
                    isValid = false;
                } else if (field.id.includes('Email') && !isValidEmail(element.value)) {
                    markFieldError(element, 'Please enter a valid email address');
                    isValid = false;
                } else {
                    clearFieldError(element);
                }
            });
            
            // Validate member count
            const memberCount = document.getElementById('memberCount');
            if (!memberCount.value) {
                markFieldError(memberCount, 'Please select number of members');
                isValid = false;
            } else {
                const count = parseInt(memberCount.value);
                if (count < 3 || count > 6) {
                    markFieldError(memberCount, 'Must have 3-6 members');
                    isValid = false;
                } else {
                    clearFieldError(memberCount);
                }
            }
            
            // Validate member fields
            const memberCountValue = parseInt(memberCount.value);
            for (let i = 1; i <= memberCountValue; i++) {
                const nameField = document.getElementById(`memberName${i}`);
                if (nameField && !nameField.value.trim()) {
                    markFieldError(nameField, `Member ${i} name is required`);
                    isValid = false;
                } else if (nameField) {
                    clearFieldError(nameField);
                }
            }
            
            return isValid;
        }
        
        function validateStep3() {
            let isValid = true;
            
            // Validate primary hymn
            const primaryHymn = document.getElementById('primaryHymn');
            if (!primaryHymn.value) {
                markFieldError(primaryHymn, 'Please select a primary hymn');
                isValid = false;
            } else if (primaryHymn.value === 'other') {
                const otherHymn = document.getElementById('otherHymn');
                if (!otherHymn.value.trim()) {
                    markFieldError(otherHymn, 'Please specify the hymn name');
                    isValid = false;
                } else {
                    clearFieldError(otherHymn);
                }
                clearFieldError(primaryHymn);
            } else {
                clearFieldError(primaryHymn);
            }
            
            // Validate performance time
            const performanceTime = document.getElementById('performanceTime');
            if (!performanceTime.value.trim()) {
                markFieldError(performanceTime, 'Performance time is required');
                isValid = false;
            } else if (!isValidTimeFormat(performanceTime.value)) {
                markFieldError(performanceTime, 'Time must be in M:SS format (max 5:00)');
                isValid = false;
            } else {
                clearFieldError(performanceTime);
            }
            
            return isValid;
        }
        
        function validateStep4() {
            // Step 4 doesn't have required fields
            return true;
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function isValidTimeFormat(time) {
            const timeRegex = /^[0-5]:[0-5][0-9]$/;
            if (!timeRegex.test(time)) return false;
            
            const [minutes, seconds] = time.split(':').map(Number);
            if (minutes === 5 && seconds > 0) return false;
            
            return true;
        }
        
        function markFieldError(element, message) {
            element.style.borderColor = 'var(--danger-color)';
            element.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.1)';
            
            // Create or update error message
            let errorElement = document.getElementById(`${element.id}Error`);
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.id = `${element.id}Error`;
                errorElement.className = 'error-message';
                errorElement.style.color = 'var(--danger-color)';
                errorElement.style.fontSize = '0.85rem';
                errorElement.style.marginTop = '5px';
                element.parentNode.appendChild(errorElement);
            }
            
            errorElement.textContent = message;
        }
        
        function clearFieldError(element) {
            element.style.borderColor = '';
            element.style.boxShadow = '';
            
            // Remove error message
            const errorElement = document.getElementById(`${element.id}Error`);
            if (errorElement) {
                errorElement.remove();
            }
        }
        
        // ============================================
        // DYNAMIC FORM ELEMENTS
        // ============================================
        function generateMemberFields() {
            const memberCount = document.getElementById('memberCount').value;
            const memberFields = document.getElementById('memberFields');
            
            if (!memberCount) {
                memberFields.innerHTML = '';
                return;
            }
            
            let html = '<div class="member-section">';
            html += '<h4>Band Members</h4>';
            
            for (let i = 1; i <= memberCount; i++) {
                html += `
                <div class="member-row">
                    <div class="form-group">
                        <label for="memberName${i}" class="${i === 1 ? 'required' : ''}">Member ${i} Name ${i === 1 ? '(Band Leader)' : ''}</label>
                        <input type="text" id="memberName${i}" placeholder="Full name" ${i === 1 ? 'required' : ''}>
                    </div>
                    <div class="form-group">
                        <label for="memberRole${i}">Role</label>
                        <select id="memberRole${i}">
                            <option value="">Select...</option>
                            <option value="Vocalist">Vocalist</option>
                            <option value="Guitarist">Guitarist</option>
                            <option value="Bassist">Bassist</option>
                            <option value="Drummer">Drummer</option>
                            <option value="Keyboardist">Keyboardist</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                `;
            }
            
            html += '</div>';
            memberFields.innerHTML = html;
            
            // Set first member as band leader
            if (memberCount >= 1) {
                const leaderNameField = document.getElementById('leaderName');
                if (leaderNameField && leaderNameField.value) {
                    document.getElementById('memberName1').value = leaderNameField.value;
                }
            }
        }
        
        function toggleOtherHymnField() {
            const primaryHymn = document.getElementById('primaryHymn');
            const otherHymnContainer = document.getElementById('otherHymnContainer');
            
            if (primaryHymn.value === 'other') {
                otherHymnContainer.style.display = 'block';
            } else {
                otherHymnContainer.style.display = 'none';
            }
        }
        
        function toggleExtraMics() {
            const extraMics = document.getElementById('extraMics');
            const extraMicCount = document.getElementById('extraMicCount');
            extraMicCount.disabled = !extraMics.checked;
        }
        
        function toggleOtherEquipment() {
            const otherEquipment = document.getElementById('otherEquipment');
            const otherEquipmentText = document.getElementById('otherEquipmentText');
            otherEquipmentText.disabled = !otherEquipment.checked;
        }
        
        // ============================================
        // FORM SUBMISSION WITH ANIMATIONS
        // ============================================
        function submitForm() {
            // Validate final step
            const agreeTerms = document.getElementById('agreeTerms');
            const confirmHymns = document.getElementById('confirmHymns');
            const signature = document.getElementById('signature');
            
            let isValid = true;
            
            if (!agreeTerms.checked) {
                markCheckboxError(agreeTerms, 'You must agree to the terms and conditions');
                isValid = false;
            } else {
                clearCheckboxError(agreeTerms);
            }
            
            if (!confirmHymns.checked) {
                markCheckboxError(confirmHymns, 'You must confirm traditional hymns only');
                isValid = false;
            } else {
                clearCheckboxError(confirmHymns);
            }
            
            if (!signature.value.trim()) {
                markFieldError(signature, 'Digital signature is required');
                isValid = false;
            } else {
                clearFieldError(signature);
            }
            
            if (!isValid) {
                showError('Please complete all required fields in the agreement section.');
                return;
            }
            
            // Collect all form data
            const formData = collectFormData();
            
            // Show enhanced loading with animation
            showLoading();
            
            // Add animation to submit button
            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.classList.add('submit-loading');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            // Submit to Google Apps Script
            google.script.run
                .withSuccessHandler(handleSubmissionSuccess)
                .withFailureHandler(handleSubmissionError)
                .submitRegistration(formData);
        }
        
        function collectFormData() {
            const formData = {
                churchName: document.getElementById('churchName').value,
                churchAddress: document.getElementById('churchAddress').value,
                pastorName: document.getElementById('pastorName').value,
                churchEmail: document.getElementById('churchEmail').value,
                churchPhone: document.getElementById('churchPhone').value,
                bandName: document.getElementById('bandName').value,
                memberCount: document.getElementById('memberCount').value,
                leaderName: document.getElementById('leaderName').value,
                leaderEmail: document.getElementById('leaderEmail').value,
                leaderPhone: document.getElementById('leaderPhone').value,
                primaryHymn: document.getElementById('primaryHymn').value,
                otherHymn: document.getElementById('otherHymn')?.value || '',
                secondaryHymn: document.getElementById('secondaryHymn').value,
                arrangement: document.getElementById('arrangement').value,
                performanceTime: document.getElementById('performanceTime').value,
                extraMics: document.getElementById('extraMics').checked,
                extraMicCount: document.getElementById('extraMicCount').value,
                keyboard: document.getElementById('keyboard').checked,
                amp: document.getElementById('amp').checked,
                percussion: document.getElementById('percussion').checked,
                otherEquipment: document.getElementById('otherEquipment').checked,
                otherEquipmentText: document.getElementById('otherEquipmentText').value,
                specialSetup: document.getElementById('specialSetup').value,
                signature: document.getElementById('signature').value,
                dashboardPassword: document.getElementById('dashboardPassword').value
            };
            
            // Add member data
            const memberCount = parseInt(formData.memberCount);
            for (let i = 1; i <= memberCount; i++) {
                formData[`memberName${i}`] = document.getElementById(`memberName${i}`)?.value || '';
                formData[`memberRole${i}`] = document.getElementById(`memberRole${i}`)?.value || '';
            }
            
            return formData;
        }
        
        function handleSubmissionSuccess(response) {
            hideLoading();
            
            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.classList.remove('submit-loading');
            submitBtn.disabled = false;
            
            if (response.success) {
                // Success animation
                submitBtn.classList.add('success-animation');
                submitBtn.innerHTML = '<i class="fas fa-check"></i> Success!';
                
                setTimeout(() => {
                    submitBtn.classList.remove('success-animation');
                    submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Registration';
                }, 2000);
                
                showSuccessModal(response);
                updateSlotStatus();
            } else {
                if (response.isWaitlist) {
                    showWaitlistModal(response);
                } else {
                    // Error animation
                    submitBtn.classList.add('error-animation');
                    submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error!';
                    
                    setTimeout(() => {
                        submitBtn.classList.remove('error-animation');
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Registration';
                    }, 1500);
                    
                    showError(response.message || 'Registration failed. Please try again.');
                }
            }
        }
        
        function handleSubmissionError(error) {
            hideLoading();
            
            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.classList.remove('submit-loading');
            submitBtn.classList.add('error-animation');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error!';
            
            setTimeout(() => {
                submitBtn.classList.remove('error-animation');
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Registration';
            }, 1500);
            
            showError('Server error: ' + error.message);
        }
        
        // ============================================
        // UI UPDATES
        // ============================================
        function updateSummary() {
            const summary = document.getElementById('registrationSummary');
            
            // Get values from form
            const churchName = document.getElementById('churchName').value;
            const bandName = document.getElementById('bandName').value;
            const memberCount = document.getElementById('memberCount').value;
            const primaryHymn = document.getElementById('primaryHymn').value === 'other' 
                ? document.getElementById('otherHymn').value 
                : document.getElementById('primaryHymn').value;
            const performanceTime = document.getElementById('performanceTime').value;
            const leaderName = document.getElementById('leaderName').value;
            const leaderEmail = document.getElementById('leaderEmail').value;
            
            let membersList = '';
            if (memberCount) {
                for (let i = 1; i <= parseInt(memberCount); i++) {
                    const nameField = document.getElementById(`memberName${i}`);
                    const roleField = document.getElementById(`memberRole${i}`);
                    if (nameField && roleField) {
                        membersList += `<div class="summary-item"><strong>${nameField.value}</strong> - ${roleField.value || 'Not specified'}</div>`;
                    }
                }
            }
            
            const html = `
                <div class="summary-grid">
                    <div class="summary-item">
                        <strong>Church:</strong><br>${churchName || 'Not provided'}
                    </div>
                    <div class="summary-item">
                        <strong>Band:</strong><br>${bandName || 'Not provided'}
                    </div>
                    <div class="summary-item">
                        <strong>Members:</strong><br>${memberCount || 'Not specified'}
                    </div>
                    <div class="summary-item">
                        <strong>Primary Hymn:</strong><br>${primaryHymn || 'Not selected'}
                    </div>
                    <div class="summary-item">
                        <strong>Performance Time:</strong><br>${performanceTime || 'Not specified'}
                    </div>
                    <div class="summary-item">
                        <strong>Band Leader:</strong><br>${leaderName || 'Not provided'}<br>
                        <small>${leaderEmail || 'No email'}</small>
                    </div>
                </div>
                ${membersList ? `<div style="margin-top: 15px;"><h5>Band Members:</h5>${membersList}</div>` : ''}
            `;
            
            summary.innerHTML = html;
        }
        
        function updateSlotStatus() {
            google.script.run
                .withSuccessHandler(handleSlotStatusSuccess)
                .withFailureHandler(handleSlotStatusError)
                .getPublicData();
        }
        
        function handleSlotStatusSuccess(data) {
            const slotCounter = document.getElementById('slotCounter');
            const statusBadge = document.getElementById('statusBadge');
            
            slotCounter.innerHTML = `Slots: ${data.totalRegistrations} of ${data.maxSlots} Filled`;
            
            if (data.registrationStatus === 'waitlist') {
                statusBadge.textContent = 'Waitlist Only';
                statusBadge.className = 'status-badge status-full';
            } else {
                statusBadge.textContent = 'Registration Open';
                statusBadge.className = 'status-badge status-open';
            }
        }
        
        function handleSlotStatusError(error) {
            console.error('Error getting slot status:', error);
        }
        
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            document.getElementById('updateTime').textContent = timeString;
        }
        
        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        function showSuccessModal(response) {
            const modal = document.getElementById('successModal');
            const message = document.getElementById('successMessage');
            const details = document.getElementById('registrationDetails');
            
            message.textContent = response.message;
            
            const detailsHtml = `
                <div style="text-align: left; margin: 15px 0; padding: 12px; background: #f8f9fa; border-radius: 8px; font-size: 0.95rem;">
                    <p><strong>Registration #:</strong> ${response.registrationNumber}</p>
                    <p><strong>Performance Order:</strong> #${response.performanceOrder}</p>
                    <p><strong>Slot:</strong> ${response.slotUsed} of ${response.totalSlots}</p>
                    <p><strong>Transaction ID:</strong> ${response.transactionId}</p>
                    <p style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ddd;">
                        <i class="fas fa-envelope" style="color: var(--primary-color);"></i> 
                        Confirmation email has been sent
                    </p>
                </div>
            `;
            
            details.innerHTML = detailsHtml;
            modal.style.display = 'flex';
        }
        
        function showWaitlistModal(response) {
            const modal = document.getElementById('successModal');
            const message = document.getElementById('successMessage');
            const details = document.getElementById('registrationDetails');
            
            message.textContent = response.message;
            
            const detailsHtml = `
                <div style="text-align: left; margin: 15px 0; padding: 12px; background: #fff8e1; border-radius: 8px; font-size: 0.95rem;">
                    <p><strong>Status:</strong> Added to waiting list</p>
                    <p><strong>Transaction ID:</strong> ${response.transactionId}</p>
                    <p><i class="fas fa-clock" style="color: var(--warning-color);"></i> You will be notified if a slot becomes available</p>
                    <p style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ddd;">
                        <i class="fas fa-envelope" style="color: var(--primary-color);"></i> 
                        Waitlist confirmation sent to your email
                    </p>
                </div>
            `;
            
            details.innerHTML = detailsHtml;
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
            // Reset form
            document.getElementById('registrationForm').reset();
            // Go back to step 1
            currentStep = 5;
            prevStep(1);
            // Clear dynamic fields
            document.getElementById('memberFields').innerHTML = '';
        }
        
        function showError(message) {
            const modal = document.getElementById('errorModal');
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.textContent = message;
            modal.style.display = 'flex';
        }
        
        function closeErrorModal() {
            document.getElementById('errorModal').style.display = 'none';
        }
        
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        function markCheckboxError(checkbox, message) {
            const parent = checkbox.parentElement;
            parent.style.color = 'var(--danger-color)';
            
            let errorElement = document.getElementById(`${checkbox.id}Error`);
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.id = `${checkbox.id}Error`;
                errorElement.className = 'error-message';
                errorElement.style.marginTop = '5px';
                parent.appendChild(errorElement);
            }
            
            errorElement.textContent = message;
        }
        
        function clearCheckboxError(checkbox) {
            const parent = checkbox.parentElement;
            parent.style.color = '';
            
            const errorElement = document.getElementById(`${checkbox.id}Error`);
            if (errorElement) {
                errorElement.remove();
            }
        }
        
        function printConfirmation() {
            window.print();
        }
        
        // ============================================
        // EVENT LISTENERS SETUP
        // ============================================
        function setupEventListeners() {
            // Equipment checkbox listeners
            document.getElementById('extraMics').addEventListener('change', toggleExtraMics);
            document.getElementById('otherEquipment').addEventListener('change', toggleOtherEquipment);
            
            // Hymn selection listener
            document.getElementById('primaryHymn').addEventListener('change', toggleOtherHymnField);
            
            // Form submission prevention
            document.getElementById('registrationForm').addEventListener('submit', function(e) {
                e.preventDefault();
            });
            
            // Handle virtual keyboard on mobile
            window.addEventListener('resize', function() {
                if (document.activeElement && document.activeElement.tagName === 'INPUT') {
                    document.activeElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            
            // Better touch handling for mobile
            document.querySelectorAll('.btn, input, select, textarea').forEach(el => {
                el.addEventListener('touchstart', function() {
                    this.style.transform = 'scale(0.98)';
                });
                
                el.addEventListener('touchend', function() {
                    this.style.transform = '';
                });
            });
        }
        
        // ============================================
        // MOBILE-SPECIFIC ENHANCEMENTS
        // ============================================
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // Initialize mobile-specific settings
        if (isMobileDevice()) {
            document.body.classList.add('mobile-device');
            
            // Adjust viewport for better mobile experience
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes';
            }
        }
    </script>
</body>
</html>
